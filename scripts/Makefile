PATH_TO_CERTS=../assets/certs
PATH_TO_KEYS=../assets/keys
SYS_OS :=
SYS_OS_TRUNC :=
SYS_ARCH :=
BINEXT :=

ifeq ($(OS),Windows_NT)
	# this is windows
	SYS_OS = windows
	SYS_OS_TRUNC = win

	# get SYS_ARCH
	ifeq ($(PROCESSOR_ARCHITEW6432),AMD64)
		SYS_ARCH = amd64
	else
		ifeq ($(PROCESSOR_ARCHITECTURE),AMD64)
			SYS_ARCH = amd64
		endif
		ifeq ($(PROCESSOR_ARCHITECTURE),x86)
				SYS_ARCH = 386
		endif
	endif
else
	# get SYS_OS
	UNAME_S := $(shell uname -s)
	ifeq ($(UNAME_S),Linux)
		SYS_OS = linux
		SYS_OS_TRUNC = linux
	endif
	ifeq ($(UNAME_S),Darwin)
		SYS_OS = darwin
		SYS_OS_TRUNC = osx
	endif

	# get SYS_ARCH
	UNAME_P := $(shell uname -p)
	ifeq ($(UNAME_P),x86_64)
		SYS_ARCH = amd64
	endif
	ifneq ($(filter %86,$(UNAME_P)),)
		SYS_ARCH = 386
	endif
	ifneq ($(filter arm%,$(UNAME_P)),)
		SYS_ARCH = arm
	endif
endif

define HELP_OUTPUT

Scripts
^^^^^^^

This directory contains utility scripts used in other places
of the project.

endef
export HELP_OUTPUT

# print the help message
help_scripts:
	@printf -- "$${HELP_OUTPUT}"

sys_info:
	@printf -- "SYS_OS       : '$(SYS_OS)'\n"
	@printf -- "SYS_OS_TRUNC : '$(SYS_OS_TRUNC)'\n"
	@printf -- "SYS_ARCH     : '$(SYS_ARCH)'\n"
	@printf -- "BIN_EXT      : '$(BIN_EXT)'\n"

ssl:
	@mkdir -p $(PATH_TO_KEYS)
	@openssl genrsa -out $(PATH_TO_KEYS)/server.key 2048
	@mkdir -p $(PATH_TO_CERTS)
	@openssl req -new -x509 -sha256 \
		-days 3650 \
		-key $(PATH_TO_KEYS)/server.key \
		-out $(PATH_TO_CERTS)/server.crt \
		-subj "/C=SG/ST=Singapore/L=Singapore/O=Sia/CN=localhost"

check_prereq_docker:
	@printf -- 'üëâüèº checking for docker...\n'
	@which docker \
		&& ls -al "$$(which docker)" \
		&& docker version --format 'client/api:{{.Client.Version}}/{{.Server.Version}}'
	@printf -- '‚úÖ docker found!\n'

check_prereq_docker_compose:
	@printf -- 'üëâüèº checking for docker-compose...\n'
	@which docker-compose \
		&& ls -al "$$(which docker-compose)" \
		&& docker-compose version
	@printf -- '‚úÖ docker-compose found!\n'

check_prereq_go:
	@printf -- 'üëâüèº checking for go...\n'
	@which go \
		&& ls -al "$$(which go)" \
		&& go version
	@printf -- '‚úÖ go found!\n'

check_prereq_kubectl:
	@printf -- 'üëâüèº checking for kubectl client...\n'
	@which kubectl \
		&& ls -al "$$(which kubectl)" \
		&& kubectl version --short --client
	@printf -- '‚úÖ kubectl client found!\n'

check_prereq_minikube:
	@printf -- 'üëâüèº checking for minikube...\n'
	@which minikube \
		&& ls -al "$$(which minikube)" \
		&& minikube version
	@printf -- '‚úÖ minikube found!\n'
