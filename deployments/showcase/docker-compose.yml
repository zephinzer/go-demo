version: "3.5"
services:
  echoserver1:
    build:
      args:
        BIN_NAME: echoserver
      context: ../../build/bin
      dockerfile: ../../deployments/Dockerfile
    image: zephinzer/demo-echoserver:latest
    environment:
      NAME: "echoserver1"
    ports:
      - 11111:11111
    volumes:
      - ../../assets/certs/server.crt:/etc/ssl/server.crt:ro
      - ../../assets/keys/server.key:/etc/ssl/server.key:ro
  echoserver2:
    build:
      args:
        BIN_NAME: echoserver
      context: ../../build/bin
      dockerfile: ../../deployments/Dockerfile
    image: zephinzer/demo-echoserver:latest
    environment:
      NAME: "echoserver2"
    ports:
      - 11112:11111
    volumes:
      - ../../assets/certs/server.crt:/etc/ssl/server.crt:ro
      - ../../assets/keys/server.key:/etc/ssl/server.key:ro
  fwdserver:
    build:
      args:
        BIN_NAME: fwdserver
      context: ../../build/bin
      dockerfile: ../../deployments/Dockerfile
    image: zephinzer/demo-fwdserver:latest
    environment:
      NAME: "fwdserver"
      # access below with https://localhost:12111/echoserver1
      ECHOSERVER1: https://echoserver1:11111
      # access below with https://localhost:12111/echoserver2
      ECHOSERVER2: https://echoserver2:11111
    ports:
      - 12111:11111
    volumes:
      - ../../assets/certs/server.crt:/etc/ssl/server.crt:ro
      - ../../assets/keys/server.key:/etc/ssl/server.key:ro
